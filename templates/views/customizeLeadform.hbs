<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed layout-compact" dir="ltr" data-theme="theme-default"
    data-assets-path="/assets/" data-template="vertical-menu-template-free">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Lead Managment</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet" />

    <link rel="stylesheet" href="/assets/vendor/fonts/boxicons.css" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="/assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="/assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="/assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="/assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="/assets/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="/assets/js/config.js"></script>
    <style>
        .contact_main {
            position: relative;
        }

        .contact_cnt {
            top: 100%;
            left: 0;
            position: absolute;
            max-height: 230px;
            background-color: white;
            width: 100%;
            overflow-x: hidden;
            overflow-y: scroll;
        }

        .contact_img {
            background: lightgray;
            border-radius: 50%;
            margin-bottom: 2px;
        }
    </style>
</head>

<body>

    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->

            {{>Sidebar}}
            <!-- / Menu -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->

                {{>navBar}}
                <!-- / Navbar -->

                <!-- Content wrapper -->
                <div class="content-wrapper">
                    <!-- Content -->

                    <div class="container-xxl flex-grow-1 container-p-y">
                        <h4 class="py-3 mb-4"><span class="text-muted fw-light"></span> Create Lead</h4>

                        <!-- Basic Layout -->
                        <div class="">

                            <div class="col-lg-8 col-mg-8  col-12 shadow-sm rounded-2 p-4"
                                style="background-color: #f0f0f000; box-shadow: rgba(0, 0, 0, 0.2) 0px 12px 28px 0px, rgba(0, 0, 0, 0.1) 0px 2px 4px 0px, rgba(255, 255, 255, 0.05) 0px 0px 0px 1px inset !important;">
                                <div class=" bg-transparent box-shadow-none">
                                    <form
                                        class="mainForm leadForm p-0 col-12 col-md-12 w-full d-flex flex-wrap justify-content-between "
                                        style="column-gap:30px;">
                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="exampleInputEmail1" class="form-label">Client Name <span
                                                    class="font-w900 text-danger">*</span> </label>
                                            <input type="text" class="form-control" id="ClientName" name="ClientName" />

                                        </div>
                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="exampleInputEmail1" class="form-label">Email<span
                                                    class="font-w900 text-danger">*</span> </label>
                                            <input type="email" class="form-control" id="email" name="email" />
                                        </div>
                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="companyName" class="form-label">Company Name <span
                                                    class="font-w900 text-danger">*</span> </label>
                                            <input type="text" class="form-control" id="companyName"
                                                name="companyName" />
                                        </div>

                                        <div class="mb-2 col-12 col-md-5  contact_main">
                                            <label for="exampleInputEmail1" class="form-label" title="contact">Contact
                                                <span class="font-w900 text-danger">*</span> </label>
                                            <input type="text" class="form-control" id="contactNumber"
                                                name="contactNumber" />

                                            <div class="w-100  contact_cnt">

                                            </div>
                                        </div>



                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="select" class="form-label">Stage<span
                                                    class="font-w900 text-danger">*</span></label>
                                            <select id="Stage" name="Stage" class="form-control" required>
                                                <option disabled selected> Select the Stage</option>
                                                <option value="New">New</option>
                                                <option value="In Progress">In Progress</option>
                                                <option value="Deal Won">Deal Won</option>
                                                <option value="Deal Lose">Deal Lose</option>
                                                <option value="Final Invoice"> Final Invoice</option>
                                            </select>
                                        </div>

                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="exampleInputEmail1" class="form-label">Amount <span
                                                    class="font-w900 text-danger">*</span></label>
                                            <input type="number" class="form-control" id="Amount" name="Amount"
                                                aria-describedby="emailHelp" value="0" required />
                                        </div>
                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="exampleInputEmail1" class="form-label">Deal Type <span
                                                    class="font-w900 text-danger">*</span></label>
                                            <input type="text" class="form-control" id="DealType" autocomplete="off"
                                                name="DealType" aria-describedby="emailHelp" required />
                                        </div>
                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="exampleInputEmail1" class="form-label">Start Date <span
                                                    class="font-w900 text-danger">*</span> </label>
                                            <input type="datetime-local" class="form-control" id="StartDate"
                                                name="StartDate" />
                                        </div>

                                        <div class="mb-2 col-12 col-md-5">
                                            <label for="exampleInputEmail1" class="form-label">End Date <span
                                                    class="font-w900 text-danger">*</span> </label>
                                            <input type="datetime-local" class="form-control" id="EndDate"
                                                name="EndDate" />
                                        </div>

                                        <div class="mb-3 col-12 col-md-5">
                                            <label for="select" class="form-label">Target Field <span
                                                    class="font-w900 text-danger">*</span><i
                                                    class="ri-add-circle-line ml-1 plusSelectField"
                                                    style="cursor: pointer;"></i></span></span><i
                                                    class="ri-delete-bin-line trash-btn ml-2"
                                                    style="cursor: pointer;"></i></span> </label>
                                            <div class="input-section" style="display: none;">
                                                <div class="input-group input-group-sm mb-3">
                                                    <input type="text" class="form-control dropdown-input"
                                                        aria-label="Small" aria-describedby="inputGroup-sizing-sm">
                                                    <div class="input-group-prepend">
                                                        <span
                                                            class="input-group-text bg-primary dropdown-input-add-btn  text-white "
                                                            id="inputGroup-sizing-sm "
                                                            style="cursor: pointer;">Add</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <select id="targetStatus" name="target_status"
                                                class="form-control target-status" required>
                                                <option value="" selected> Select Lead Status</option>
                                                {{!-- Value comes dynamically --}}

                                            </select>
                                        </div>
                                        <div class="mb-3 col-12 col-md-5">
                                            <label for="select" class="form-label">Product<span
                                                    class="font-w900 text-danger">*</span></label>
                                            <input type="text" name="Product" id="Product" class="form-control"
                                                value="">
                                        </div>

                                        <div class="mb-3 col-12 col-md-5">
                                            <label for="select" class="form-label">Responsible Person<span
                                                    class="font-w900 text-danger">*</span></label>
                                            <input type="text" name="responsible_person" id="responsible_person"
                                                class="form-control" value="{{username}}">
                                        </div>


                                    </form>
                                    <div class="d-flex gap-2 col-md-12 col-12">
                                        <button type="submit" id="leadSubmitBtn"
                                            class=" btn btn-primary btn-md rounded-1 mt-2">Submit</button>
                                        {{#if isAdmin}}
                                        <button type="button" class="addField btn btn-primary btn-sm rounded-1 mt-2">Add
                                            Field</button>
                                        {{else}}
                                        {{/if}}
                                        {{!-- <button type="button"
                                            class="addField btn ml-3 btn-primary btn-md rounded-1 mt-2">Add
                                            Field</button> --}}
                                    </div>
                                    <dialog autofocus="true" class="col-md-3 col-10 m-0"
                                        style="position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);border: none;padding: 14px;">
                                        <div class="closeBtn float-end d-block " style="width: 25px;float:right">
                                            <svg style="cursor: pointer;" xmlns="http://www.w3.org/2000/svg"
                                                viewBox="0 0 24 24" fill="currentColor">
                                                <path
                                                    d="M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z">
                                                </path>
                                            </svg>
                                        </div>

                                        <div class="content mt-1 w-100">
                                            {{!-- making for custom field's --}}
                                            <form class="customFieldForm py-2">
                                                <label for="customField" class="form-label h3 font-w500">Custom
                                                    Field</label>
                                                <div class="wrapper-div px-0 d-flex align-items-center col-md-12 col-12 flex-wrap py-2"
                                                    style="gap: 10px;">
                                                    <div
                                                        class="d-flex align-items-center col-md-2 col-3 justify-content-start ">
                                                        <label for="textField1" class="m-0 font-w500">Date</label>
                                                        <input type="radio" name="fields" class="mx-2 rounded"
                                                            id="textField1" value="date">
                                                    </div>
                                                    <div
                                                        class="d-flex align-items-center col-md-2 col-3 justify-content-start">
                                                        <label for="textField2" class="m-0 font-w500">Text</label>
                                                        <input type="radio" name="fields" class="mx-2 rounded"
                                                            id="textField2" value="text">
                                                    </div>
                                                    <div
                                                        class="d-flex align-items-center col-md-3   col-3 justify-content-start">
                                                        <label for="textField3" class="m-0 font-w500">Number</label>
                                                        <input type="radio" name="fields" class="mx-2 rounded"
                                                            id="textField3" value="number">
                                                    </div>


                                                </div>


                                                <div class="my-2 mb-2">
                                                    <label for="lableName" class="form-label">Label Name</label>
                                                    <input type="text" class="form-control  mb-1 mt-1" name="labelValue"
                                                        id="lableName" placeholder="Enter the label name">
                                                </div>

                                                <button type="submit"
                                                    class="w-100 btn btn-primary btn-sm rounded-1 mt-2 fieldBtn">Submit</button>
                                            </form>

                                        </div>


                                    </dialog>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- / Content -->

                    <!-- Footer -->
                    {{>footer}}
                    <!-- / Footer -->

                    <div class="content-backdrop fade"></div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>


</body>

<script src="/scripts/customizeleadform.js"></script>
<!-- Main JS -->
<script src="/assets/js/main.js"></script>

</html>

<style>
    .content-wrapper {
        transition: filter 0.3s ease;
        /* Add transition for smooth effect */
    }

    .blur-body {
        filter: blur(5px);
        /* Adjust the blur amount as needed */
    }

    @media(max-width:800px) {
        .bg-menu-theme {
            background-color: #ffffffba !important;
        }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const layoutMenuToggle = document.querySelector('.bx-menu');
        const contentWrapper = document.querySelector('.content-wrapper');
        const layOutackRemove = document.querySelector('.bx-chevron-left');


        layoutMenuToggle.addEventListener('click', function () {
            contentWrapper.classList.toggle('blur-body');
        });

        layOutackRemove.addEventListener('click', function () {
            contentWrapper.classList.remove('blur-body');

        })
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const layoutMenuToggle = document.querySelector('.bx-menu');
        const contentWrapper = document.querySelector('.content-wrapper');
        const layOutackRemove = document.querySelector('.bx-chevron-left');

        layoutMenuToggle.addEventListener('click', function () {
            contentWrapper.classList.toggle('blur-body');
        });

        layOutackRemove.addEventListener('click', function () {
            contentWrapper.classList.remove('blur-body');
        });

        const contactPerson = document.getElementById('contactNumber');
        contactPerson.addEventListener('input', async (e) => {
            const value = e.target.value.toLowerCase();
        
            await getAllData(value);
        });

        async function getAllData(value) {
            try {
                const res = await fetch('/filter-contact', {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contact: value
                    })
                });
                const data = await res.json();

                if (data.success) {
                    const contactCnt = document.querySelector('.contact_cnt');
                    contactCnt.innerHTML = '';

                    data.alldata.forEach(contact => {
                       
                        const card = document.createElement('div');
                        card.classList.add('card');
                        card.innerHTML = `
                                   <div class="wrapper d-flex gap-3 px-3 py-2 mx-auto my-1 border rounded-2 align-items-center" style="width: 80%;">
                                                    <div class="img-no">
                                                    <img class="rounded-circle" style="background-color: lightgray;" src="https://upload.wikimedia.org/wikipedia/commons/9/99/Sample_User_Icon.png"
                                                        alt="" width="40" height="40">
                                                </div>
                                                 <div class="div">
                                                     <small class="m-0 d-block">${contact.ClientName}</small>
                                                  <small class="m-0 d-block">${contact.contactNumber}</small>
                                                 </div>
                                                </div>
                               `;
                        contactCnt.appendChild(card);
                    });
                }

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
    });

</script>